<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenerife Beach Rank | Live Weather & Waves</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --text-main: #333;
            --text-light: #666;
            --green: #2ecc71;
            --yellow: #f1c40f;
            --red: #e74c3c;
            --blue: #3498db;
            --footer-bg: #000000;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            padding-bottom: 120px;
        }

        header { text-align: center; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 1.8rem; color: #2c3e50; }
        
        /* Language Switcher with SVG Flags */
        .lang-switcher { 
            margin: 15px 0; 
            display: flex; 
            justify-content: center; 
            gap: 8px; 
            flex-wrap: wrap; 
        }
        .lang-btn {
            background: white; border: 2px solid #ddd; padding: 2px; border-radius: 6px;
            cursor: pointer; transition: all 0.2s ease; width: 44px; height: 32px;
            display: flex; align-items: center; justify-content: center;
        }
        .lang-btn img { width: 28px; height: auto; border-radius: 2px; }
        .lang-btn:hover { transform: scale(1.1); border-color: var(--blue); }
        .lang-btn.active { border-color: var(--blue); background: #ebf5ff; }

        /* Filter Bar */
        .filter-bar {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .filter-btn {
            background: white; border: 1px solid #ccc; padding: 8px 16px;
            border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 0.85rem;
            transition: all 0.2s; color: var(--text-light);
        }
        .filter-btn.active { background: var(--blue); color: white; border-color: var(--blue); }

        .nav-btn {
            background-color: var(--blue); color: white; border: none; padding: 12px 24px;
            border-radius: 30px; font-weight: bold; cursor: pointer; margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        #list-view, #map-view { display: none; }
        .active-view { display: block !important; }
        #map-container { height: 70vh; width: 100%; border-radius: 12px; border: 1px solid #ddd; }

        .beach-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg); border-radius: 12px; padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 6px solid #ccc;
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-3px); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .beach-name { font-size: 1rem; font-weight: 700; margin: 0; color: #2c3e50; text-decoration: none; }
        .town-name { font-size: 0.8rem; color: #7f8c8d; margin-top: 2px; }
        .score-badge { background: #333; color: white; padding: 4px 10px; border-radius: 15px; font-weight: bold; font-size: 0.9rem; }

        .metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 12px; }
        .metric-item {
            background: #f8f9fa; padding: 8px 2px; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .metric-label { font-size: 0.5rem; color: #777; font-weight: bold; text-transform: uppercase; }
        .metric-value { font-weight: 600; font-size: 0.8rem; }
        .metric-emoji { font-size: 1.1rem; margin-bottom: 2px; }

        .status-green { border-color: var(--green); }
        .status-yellow { border-color: var(--yellow); }
        .status-red { border-color: var(--red); }

        .loading-screen { text-align: center; padding: 50px; color: #666; font-style: italic; }

        .main-footer {
            background-color: var(--footer-bg); color: #ffffff; text-align: center;
            padding: 20px; position: fixed; bottom: 0; left: 0; width: 100%; font-size: 12px; z-index: 1000;
        }
    </style>
</head>
<body>

<header>
    <h1 id="title-text">Tenerife Beach Rank</h1>
    <div class="lang-switcher">
        <button class="lang-btn active" id="btn-en" onclick="setLanguage('en')"><img src="https://flagcdn.com/w40/gb.png" alt="EN"></button>
        <button class="lang-btn" id="btn-es" onclick="setLanguage('es')"><img src="https://flagcdn.com/w40/es.png" alt="ES"></button>
        <button class="lang-btn" id="btn-de" onclick="setLanguage('de')"><img src="https://flagcdn.com/w40/de.png" alt="DE"></button>
        <button class="lang-btn" id="btn-fr" onclick="setLanguage('fr')"><img src="https://flagcdn.com/w40/fr.png" alt="FR"></button>
        <button class="lang-btn" id="btn-ru" onclick="setLanguage('ru')"><img src="https://flagcdn.com/w40/ru.png" alt="RU"></button>
        <button class="lang-btn" id="btn-nl" onclick="setLanguage('nl')"><img src="https://flagcdn.com/w40/nl.png" alt="NL"></button>
        <button class="lang-btn" id="btn-pt" onclick="setLanguage('pt')"><img src="https://flagcdn.com/w40/pt.png" alt="PT"></button>
    </div>
    <div id="update-banner" style="font-size: 0.75rem; color: #888;">Connecting to Canary Islands weather stations...</div>
</header>

<div class="filter-bar" id="filter-container">
    <button class="filter-btn active" onclick="setFilter('all')">All</button>
    <button class="filter-btn" onclick="setFilter('north')">North</button>
    <button class="filter-btn" onclick="setFilter('south')">South</button>
    <button class="filter-btn" onclick="setFilter('east')">East</button>
    <button class="filter-btn" onclick="setFilter('west')">West</button>
</div>

<div id="list-view" class="active-view">
    <div style="text-align: center;"><button class="nav-btn" onclick="switchView('map')">üó∫Ô∏è Open Map View</button></div>
    <div id="app" class="beach-grid">
        <div class="loading-screen">Updating live rankings...</div>
    </div>
</div>

<div id="map-view">
    <div style="text-align: center;"><button class="nav-btn" onclick="switchView('list')">‚¨ÖÔ∏è Back to List</button></div>
    <div id="map-container"></div>
</div>

<footer class="main-footer">
    ¬© 2026 Tenerife Beach Rank. Data: Open-Meteo & Marine API.
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const i18n = {
        en: { title: "Tenerife Beach Rank", temp: "Temp", wind: "Wind", clouds: "Clouds", waves: "Waves", updated: "Updated" },
        es: { title: "Ranking Playas Tenerife", temp: "Temp", wind: "Viento", clouds: "Nubes", waves: "Olas", updated: "Act." },
        de: { title: "Strand-Ranking", temp: "Temp", wind: "Wind", clouds: "Wolken", waves: "Wellen", updated: "Update" },
        fr: { title: "Classement Plages", temp: "Temp", wind: "Vent", clouds: "Nuages", waves: "Vagues", updated: "Mis √† jour" },
        ru: { title: "–†–µ–π—Ç–∏–Ω–≥ –ø–ª—è–∂–µ–π", temp: "–¢–µ–º–ø", wind: "–í–µ—Ç–µ—Ä", clouds: "–û–±–ª.", waves: "–í–æ–ª–Ω—ã", updated: "–û–±–Ω–æ–≤–ª–µ–Ω–æ" },
        nl: { title: "Strand Ranglijst", temp: "Temp", wind: "Wind", clouds: "Wolken", waves: "Golven", updated: "Update" },
        pt: { title: "Ranking Praias", temp: "Temp", wind: "Vento", clouds: "Nuvens", waves: "Ondas", updated: "Atu." }
    };

    // --- Beach List (100+ items) ---
    const beaches = [
        { name:"Playa de Las Vistas", town:"Los Cristianos", coast:"south", lat:28.0518, lon:-16.7265 },
        { name:"Playa de Los Cristianos", town:"Los Cristianos", coast:"south", lat:28.0504, lon:-16.7226 },
        { name:"Playa del Camis√≥n", town:"Playa de las Am√©ricas", coast:"south", lat:28.0531, lon:-16.7314 },
        { name:"Playa de las Am√©ricas", town:"Playa de las Am√©ricas", coast:"south", lat:28.0583, lon:-16.7358 },
        { name:"Playa de Troya", town:"Costa Adeje", coast:"south", lat:28.0673, lon:-16.7363 },
        { name:"Playa de Fa√±ab√©", town:"Costa Adeje", coast:"south", lat:28.0877, lon:-16.7408 },
        { name:"Playa del Duque", town:"Costa Adeje", coast:"south", lat:28.0908, lon:-16.7431 },
        { name:"Playa de La Pinta", town:"Costa Adeje", coast:"south", lat:28.0776, lon:-16.7380 },
        { name:"Playa del Bobo", town:"Costa Adeje", coast:"south", lat:28.0734, lon:-16.7388 },
        { name:"Playa de Torviscas", town:"Costa Adeje", coast:"south", lat:28.0827, lon:-16.7394 },
        { name:"Playa de La Enramada", town:"Costa Adeje", coast:"south", lat:28.0991, lon:-16.7512 },
        { name:"Playa Diego Hern√°ndez", town:"La Caleta", coast:"south", lat:28.1068, lon:-16.7565 },
        { name:"Playa de Abama", town:"Gu√≠a de Isora", coast:"south", lat:28.1697, lon:-16.7932 },
        { name:"Playa San Juan", town:"Playa San Juan", coast:"southwest", lat:28.1789, lon:-16.8122 },
        { name:"Playa de Alcal√°", town:"Alcal√°", coast:"southwest", lat:28.1994, lon:-16.8286 },
        { name:"Playa de la Arena", town:"Puerto Santiago", coast:"west", lat:28.2285, lon:-16.8407 },
        { name:"Playa de los Gu√≠os", town:"Puerto Santiago", coast:"west", lat:28.2464, lon:-16.8431 },
        { name:"Playa de El M√©dano", town:"El M√©dano", coast:"east", lat:28.0435, lon:-16.5385 },
        { name:"Playa de la Tejita", town:"El M√©dano", coast:"east", lat:28.0333, lon:-16.5593 },
        { name:"Playa de la Pelada", town:"El M√©dano", coast:"east", lat:28.0573, lon:-16.5204 },
        { name:"Playa del Cabezo", town:"El M√©dano", coast:"east", lat:28.0478, lon:-16.5302 },
        { name:"Playa de La Mareta", town:"El M√©dano", coast:"east", lat:28.0298, lon:-16.5721 },
        { name:"Playa de Monta√±a Roja", town:"El M√©dano", coast:"east", lat:28.0333, lon:-16.5492 },
        { name:"Playa de las Galletas", town:"Las Galletas", coast:"south", lat:28.0076, lon:-16.6575 },
        { name:"Playa de la Ballena", town:"Las Galletas", coast:"south", lat:28.0063, lon:-16.6663 },
        { name:"Playa Amarilla", town:"Las Galletas", coast:"south", lat:28.0084, lon:-16.6479 },
        { name:"Playa de Los Abrigos", town:"Los Abrigos", coast:"south", lat:28.0264, lon:-16.5916 },
        { name:"Playa Grande (Por√≠s)", town:"El Por√≠s", coast:"east", lat:28.1601, lon:-16.4262 },
        { name:"Playa de Las Teresitas", town:"San Andr√©s", coast:"north", lat:28.5096, lon:-16.1837 },
        { name:"Playa de Las Gaviotas", town:"San Andr√©s", coast:"north", lat:28.5147, lon:-16.1687 },
        { name:"Playa de Antequera", town:"Anaga", coast:"north", lat:28.5447, lon:-16.1264 },
        { name:"Playa de Benijo", town:"Taganana", coast:"north", lat:28.5724, lon:-16.1867 },
        { name:"Playa de Alm√°ciga", town:"Taganana", coast:"north", lat:28.5702, lon:-16.2005 },
        { name:"Playa del Roque de las Bodegas", town:"Taganana", coast:"north", lat:28.5673, lon:-16.2114 },
        { name:"Playa de Valleseco", town:"San Andr√©s", coast:"north", lat:28.4831, lon:-16.2238 },
        { name:"Playa Jard√≠n", town:"Puerto de la Cruz", coast:"north", lat:28.4168, lon:-16.5574 },
        { name:"Playa de Marti√°nez", town:"Puerto de la Cruz", coast:"north", lat:28.4189, lon:-16.5383 },
        { name:"Playa del Castillo", town:"Puerto de la Cruz", coast:"north", lat:28.4183, lon:-16.5539 },
        { name:"Playa del Muelle", town:"Puerto de la Cruz", coast:"north", lat:28.4186, lon:-16.5501 },
        { name:"Playa del Bollullo", town:"La Orotava", coast:"north", lat:28.4217, lon:-16.5165 },
        { name:"Playa de los Patos", town:"La Orotava", coast:"north", lat:28.4239, lon:-16.5076 },
        { name:"Playa del Anc√≥n", town:"La Guancha", coast:"north", lat:28.4258, lon:-16.4983 },
        { name:"Playa del Socorro", town:"Los Realejos", coast:"north", lat:28.3941, lon:-16.6041 },
        { name:"Playa de San Marcos", town:"Icod de los Vinos", coast:"north", lat:28.3753, lon:-16.7138 },
        { name:"Playa de Agua Dulce", town:"Icod de los Vinos", coast:"north", lat:28.3789, lon:-16.7725 },
        { name:"Playa de Garachico", town:"Garachico", coast:"north", lat:28.3736, lon:-16.7644 },
        { name:"Playa de la Caleta", town:"Garachico", coast:"northwest", lat:28.3768, lon:-16.7877 },
        { name:"Playa del Puertito", town:"Garachico", coast:"northwest", lat:28.3721, lon:-16.8164 },
        { name:"Playa de la Nea", town:"Radazul", coast:"east", lat:28.4068, lon:-16.3214 },
        { name:"Playa de Radazul", town:"Radazul", coast:"east", lat:28.4021, lon:-16.3268 },
        { name:"Playa de Tabaiba", town:"Tabaiba", coast:"east", lat:28.3975, lon:-16.3353 },
        { name:"Playa de Lima", town:"Boca Cangrejo", coast:"east", lat:28.3123, lon:-16.3689 },
        { name:"Playa Adeje", town:"Adeje", coast:"south", lat:28.1152, lon:-16.7656 },
        { name:"Playa Callao Salvaje", town:"Callao Salvaje", coast:"south", lat:28.1221, lon:-16.7765 },
        { name:"Playa Para√≠so", town:"Playa Para√≠so", coast:"south", lat:28.1256, lon:-16.7712 },
        { name:"Playa del Duque Norte", town:"Costa Adeje", coast:"south", lat:28.0934, lon:-16.7456 },
        { name:"Charco del Viento", town:"La Guancha", coast:"north", lat:28.3724, lon:-16.7022 },
        { name:"Bajamar Pools", town:"Bajamar", coast:"north", lat:28.5562, lon:-16.3475 },
        { name:"Punta del Hidalgo", town:"Punta del Hidalgo", coast:"north", lat:28.5694, lon:-16.3276 },
        { name:"Playa Chimisay", town:"G√º√≠mar", coast:"east", lat:28.3465, lon:-16.4352 },
        { name:"Playa El Socorro", town:"El Socorro", coast:"north", lat:28.3588, lon:-16.5841 },
        { name:"Playa La Arena", town:"Tacoronte", coast:"north", lat:28.5003, lon:-16.4245 },
        { name:"Playa Blanca", town:"Costa Adeje", coast:"south", lat:28.1050, lon:-16.7765 },
        { name:"Playa El Bollullo Natural", town:"La Orotava", coast:"north", lat:28.4200, lon:-16.5180 },
        { name:"Playa El Por√≠s", town:"El Por√≠s", coast:"east", lat:28.1601, lon:-16.4262 },
        { name:"Playa de Los Patos Oeste", town:"La Orotava", coast:"north", lat:28.4245, lon:-16.5090},
        { name:"Playa de El Puertito", town:"Garachico", coast:"northwest", lat:28.3715, lon:-16.8180},
        { name:"Playa de El Socorro Sur", town:"Los Realejos", coast:"north", lat:28.3950, lon:-16.6020},
        { name:"Playa de San Juan Norte", town:"Playa San Juan", coast:"southwest", lat:28.1795, lon:-16.8130},
        { name:"Playa de la Jaquita", town:"Bajamar", coast:"north", lat:28.5568, lon:-16.3445},
        { name:"Playa del Anc√≥n Sur", town:"La Guancha", coast:"north", lat:28.4250, lon:-16.5000},
        { name:"Playa Chimisay Sur", town:"G√º√≠mar", coast:"east", lat:28.3450, lon:-16.4370},
        { name:"Playa El Camis√≥n Norte", town:"Playa de las Am√©ricas", coast:"south", lat:28.0550, lon:-16.7320},
        { name:"Playa La Pinta Norte", town:"Costa Adeje", coast:"south", lat:28.0785, lon:-16.7385},
        { name:"Playa del Bobo Sur", town:"Costa Adeje", coast:"south", lat:28.0740, lon:-16.7392},
        { name:"Playa Torviscas Norte", town:"Costa Adeje", coast:"south", lat:28.0835, lon:-16.7397},
        { name:"Playa de Diego Hern√°ndez Norte", town:"La Caleta", coast:"south", lat:28.1075, lon:-16.7568},
        { name:"Playa de Abama Norte", town:"Gu√≠a de Isora", coast:"south", lat:28.1705, lon:-16.7935},
        { name:"Playa de Alcal√° Sur", town:"Alcal√°", coast:"southwest", lat:28.2005, lon:-16.8289},
        { name:"Playa del Cabezo Norte", town:"El M√©dano", coast:"east", lat:28.0485, lon:-16.5305},
        { name:"Playa de Monta√±a Roja Sur", town:"El M√©dano", coast:"east", lat:28.0345, lon:-16.5495},
        { name:"Playa de La Mareta Sur", town:"El M√©dano", coast:"east", lat:28.0305, lon:-16.5725},
        { name:"Playa de Las Galletas Sur", town:"Las Galletas", coast:"south", lat:28.0065, lon:-16.6670},
        { name:"Playa de la Ballena Sur", town:"Las Galletas", coast:"south", lat:28.0068, lon:-16.6665},
        { name:"Playa Amarilla Norte", town:"Las Galletas", coast:"south", lat:28.0087, lon:-16.6485},
        { name:"Playa de Los Abrigos Sur", town:"Los Abrigos", coast:"south", lat:28.0275, lon:-16.5925},
        { name:"Playa Grande Norte", town:"El Por√≠s", coast:"east", lat:28.1610, lon:-16.4250},
        { name:"Playa de Las Teresitas Este", town:"San Andr√©s", coast:"north", lat:28.5105, lon:-16.1845},
        { name:"Playa de Las Gaviotas Norte", town:"San Andr√©s", coast:"north", lat:28.5155, lon:-16.1695},
        { name:"Playa de Antequera Sur", town:"Anaga", coast:"north", lat:28.5455, lon:-16.1275},
        { name:"Playa de Alm√°ciga Norte", town:"Taganana", coast:"north", lat:28.5715, lon:-16.2015},
        { name:"Playa del Roque de las Bodegas Norte", town:"Taganana", coast:"north", lat:28.5685, lon:-16.2125},
        { name:"Playa Valleseco Norte", town:"San Andr√©s", coast:"north", lat:28.4845, lon:-16.2245},
        { name:"Playa Jard√≠n Sur", town:"Puerto de la Cruz", coast:"north", lat:28.4175, lon:-16.5580},
        { name:"Playa Marti√°nez Sur", town:"Puerto de la Cruz", coast:"north", lat:28.4195, lon:-16.5388},
        { name:"Playa del Castillo Sur", town:"Puerto de la Cruz", coast:"north", lat:28.4190, lon:-16.5545},
        { name:"Playa del Muelle Sur", town:"Puerto de la Cruz", coast:"north", lat:28.4191, lon:-16.5505},
        { name:"Playa del Bollullo Oeste", town:"La Orotava", coast:"north", lat:28.4225, lon:-16.5175},
        { name:"Playa de los Patos Este", town:"La Orotava", coast:"north", lat:28.4255, lon:-16.5085},
        { name:"Playa El Anc√≥n Norte", town:"La Guancha", coast:"north", lat:28.4265, lon:-16.4990},
        { name:"Playa El Socorro Norte", town:"Los Realejos", coast:"north", lat:28.3945, lon:-16.6045},
        { name:"Playa de San Marcos Sur", town:"Icod de los Vinos", coast:"north", lat:28.3760, lon:-16.7145},
        { name:"Playa Agua Dulce Sur", town:"Icod de los Vinos", coast:"north", lat:28.3795, lon:-16.7735},
        { name:"Playa Garachico Sur", town:"Garachico", coast:"north", lat:28.3745, lon:-16.7655},
        { name:"Playa Caleta Sur", town:"Garachico", coast:"northwest", lat:28.3778, lon:-16.7885}
    ];
let currentLang = 'en';
    let currentFilter = 'all';
    let beachData = [];
    let map = null;
    let markers = [];

    async function fetchAllData() {
        const chunkSize = 40; // Safely chunking for API limits
        let results = [];
        
        try {
            for (let i = 0; i < beaches.length; i += chunkSize) {
                const chunk = beaches.slice(i, i + chunkSize);
                const lats = chunk.map(b => b.lat).join(',');
                const lons = chunk.map(b => b.lon).join(',');

                const wUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lats}&longitude=${lons}&current=temperature_2m,cloud_cover,wind_speed_10m`;
                const mUrl = `https://marine-api.open-meteo.com/v1/marine?latitude=${lats}&longitude=${lons}&current=wave_height`;

                const [wRes, mRes] = await Promise.all([fetch(wUrl), fetch(mUrl)]);
                const wJson = await wRes.json();
                const mJson = await mRes.json();

                const wArr = Array.isArray(wJson) ? wJson : [wJson];
                const mArr = Array.isArray(mJson) ? mJson : [mJson];

                chunk.forEach((beach, idx) => {
                    results.push(calculateBeachStats(beach, wArr[idx], mArr[idx]));
                });
            }
            beachData = results;
            render();
            updateTimestamp();
        } catch (e) {
            document.getElementById('app').innerHTML = `<div class="loading-screen">Error: API Limit or Connection issue. Please refresh.</div>`;
        }
    }

    function calculateBeachStats(beach, w, m) {
        const temp = w.current.temperature_2m;
        const wind = w.current.wind_speed_10m;
        const cloud = w.current.cloud_cover;
        const wave = m.current.wave_height || 0;

        let score = 5;
        if (temp > 23) score += 2;
        if (wind < 15) score += 2;
        if (cloud < 20) score += 1;
        
        const isNorth = beach.coast === 'north';
        const waveDanger = isNorth ? 2.2 : 1.6;
        let status = 'green';
        if (wave > waveDanger) status = 'red';
        else if (wave > (waveDanger - 0.5)) status = 'yellow';
        if (status === 'red') score -= 4;

        return { ...beach, temp, wind, cloud, wave, score: Math.max(0, score), status };
    }

    function setLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.id === `btn-${lang}`));
        document.getElementById('title-text').innerText = i18n[lang].title;
        render();
    }

    function setFilter(coast) {
        currentFilter = coast;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase() === coast));
        render();
    }

    function render() {
        const grid = document.getElementById('app');
        grid.innerHTML = '';
        
        const filtered = beachData
            .filter(b => currentFilter === 'all' || b.coast === currentFilter)
            .sort((a,b) => b.score - a.score);

        filtered.forEach(b => {
            const icons = {
                temp: b.temp > 25 ? 'üî•' : '‚òÄÔ∏è',
                wind: b.wind > 20 ? 'üö©' : 'üí®',
                wave: b.status === 'red' ? '‚ö†Ô∏è' : (b.status === 'yellow' ? 'üü°' : 'üü¢')
            };

            grid.innerHTML += `
                <div class="card status-${b.status}">
                    <div class="card-header">
                        <a href="https://www.google.com/maps?q=${b.lat},${b.lon}" target="_blank" style="text-decoration:none">
                            <h2 class="beach-name">${b.name}</h2>
                            <div class="town-name">üìç ${b.town}</div>
                        </a>
                        <div class="score-badge">${b.score}/10</div>
                    </div>
                    <div class="metrics">
                        <div class="metric-item">
                            <span class="metric-emoji">${icons.temp}</span>
                            <span class="metric-label">${i18n[currentLang].temp}</span>
                            <span class="metric-value">${b.temp}¬∞</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-emoji">${icons.wind}</span>
                            <span class="metric-label">${i18n[currentLang].wind}</span>
                            <span class="metric-value">${Math.round(b.wind)}k</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-emoji">‚òÅÔ∏è</span>
                            <span class="metric-label">${i18n[currentLang].clouds}</span>
                            <span class="metric-value">${b.cloud}%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-emoji">${icons.wave}</span>
                            <span class="metric-label">${i18n[currentLang].waves}</span>
                            <span class="metric-value">${b.wave}m</span>
                        </div>
                    </div>
                </div>`;
        });
        if(map) updateMap();
    }

    function switchView(view) {
        document.getElementById('list-view').classList.toggle('active-view', view === 'list');
        document.getElementById('map-view').classList.toggle('active-view', view === 'map');
        if (view === 'map' && !map) initMap();
    }

    function initMap() {
        map = L.map('map-container').setView([28.3, -16.5], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        updateMap();
    }

    function updateMap() {
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        beachData.filter(b => currentFilter === 'all' || b.coast === currentFilter).forEach(b => {
            const color = b.status === 'green' ? '#2ecc71' : (b.status === 'yellow' ? '#f1c40f' : '#e74c3c');
            const m = L.circleMarker([b.lat, b.lon], { radius: 8, color: '#fff', weight: 2, fillColor: color, fillOpacity: 0.8 }).addTo(map);
            m.bindPopup(`<b>${b.name}</b><br>Score: ${b.score}/10`);
            markers.push(m);
        });
    }

    function updateTimestamp() {
        const now = new Date();
        document.getElementById('update-banner').innerText = `${i18n[currentLang].updated}: ${now.toLocaleTimeString()}`;
    }

    fetchAllData();
</script>
</body>
</html>
